{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://foolsgambit.dev/schemas/majors.schema.json",
  "title": "Fool's Gambit - Majors Content",
  "type": "object",
  "additionalProperties": false,
  "required": ["contentVersion", "majors"],
  "properties": {
    "contentVersion": {
      "type": "string",
      "minLength": 1,
      "description": "Bump/change whenever majors or referenced strings change."
    },
    "majors": {
      "type": "array",
      "minItems": 21,
      "maxItems": 21,
      "items": { "$ref": "#/$defs/MajorDefinition" }
    }
  },
  "$defs": {
    "MajorId": {
      "type": "string",
      "enum": [
        "magician",
        "high_priestess",
        "empress",
        "emperor",
        "hierophant",
        "lovers",
        "chariot",
        "strength",
        "hermit",
        "wheel",
        "justice",
        "hanged_man",
        "death",
        "temperance",
        "devil",
        "tower",
        "star",
        "moon",
        "sun",
        "judgement",
        "world"
      ]
    },
    "HookId": {
      "type": "string",
      "enum": [
        "FLOOR_START",
        "ROOM_REVEALED",
        "ORDER_CONSTRAINT",
        "BEFORE_FIRST_RESOLVE_ATTEMPT",
        "AFTER_FIRST_RESOLUTION"
      ]
    },
    "StringKey": { "type": "string", "minLength": 1 },

    "MajorUi": {
      "type": "object",
      "additionalProperties": false,
      "required": ["nameKey", "shadowSummaryKey", "giftSummaryKey"],
      "properties": {
        "nameKey": { "$ref": "#/$defs/StringKey" },
        "shadowSummaryKey": { "$ref": "#/$defs/StringKey" },
        "giftSummaryKey": { "$ref": "#/$defs/StringKey" }
      }
    },

    "MajorShadow": {
      "type": "object",
      "additionalProperties": false,
      "required": ["trigger", "effect"],
      "properties": {
        "trigger": { "$ref": "#/$defs/HookId" },
        "effect": { "$ref": "#/$defs/EffectNode" }
      }
    },

    "MajorGift": {
      "type": "object",
      "additionalProperties": false,
      "required": ["effect"],
      "properties": {
        "effect": { "$ref": "#/$defs/EffectNode" }
      }
    },

    "MajorDefinition": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "ui", "shadow", "gift"],
      "properties": {
        "id": { "$ref": "#/$defs/MajorId" },
        "ui": { "$ref": "#/$defs/MajorUi" },
        "shadow": { "$ref": "#/$defs/MajorShadow" },
        "gift": { "$ref": "#/$defs/MajorGift" }
      }
    },

    "SelectorKind": {
      "type": "string",
      "enum": [
        "PLAYER_CHOICE",
        "RANDOM",
        "LEFTMOST",
        "HIGHEST_VALUE",
        "IF_ENEMY_PRESENT_PLAYER_CHOICE",
        "IF_ANY_REVERSED_PLAYER_CHOICE"
      ]
    },

    "Selector": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kind"],
      "properties": {
        "kind": { "$ref": "#/$defs/SelectorKind" },
        "tieBreak": { "type": "string", "enum": ["PLAYER_CHOICE"] }
      }
    },

    "EffectType": {
      "type": "string",
      "enum": [
        "NOOP",
        "SEQUENCE",
        "CHOICE",
        "CONDITIONAL",

        "REROLL_REVEALED",
        "EXILE_REPLACE_REVEALED",
        "CLEANSE_REVEALED",

        "PEEK_TOP_N",
        "REORDER_TOP_N",
        "REORDER_ROOM_BY_VALUE",
        "REORDER_ROOM_ARBITRARY",

        "BARGAIN",

        "DISABLE_FATE_ACTION",
        "SET_WEAPON_RESTRICTION_MODE",
        "SET_ORDER_CONSTRAINT",
        "SET_FLOOR_PARAM",
        "FORCED_EXILE_FIRST_RESOLVE_ATTEMPT"
      ]
    },

    "EffectNode": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type"],
      "properties": {
        "type": { "$ref": "#/$defs/EffectType" },

        "effects": {
          "type": "array",
          "items": { "$ref": "#/$defs/EffectNode" }
        },

        "promptKey": { "$ref": "#/$defs/StringKey" },
        "options": {
          "type": "array",
          "items": { "$ref": "#/$defs/ChoiceOption" }
        },

        "if": { "$ref": "#/$defs/Predicate" },
        "then": { "$ref": "#/$defs/EffectNode" },
        "else": { "$ref": "#/$defs/EffectNode" },

        "selector": { "$ref": "#/$defs/Selector" },

        "n": { "type": "integer", "enum": [3] },
        "canReorder": { "type": "boolean" },

        "fateAction": { "type": "string", "enum": ["CLEANSE", "REROLL"] },
        "scope": { "type": "string", "enum": ["THIS_ROOM", "THIS_FLOOR"] },

        "weaponRestrictionMode": { "type": "string", "enum": ["DEFAULT", "STRICT"] },

        "orderConstraint": {
          "type": "string",
          "enum": ["NONE", "LEFT_TO_RIGHT", "RIGHT_TO_LEFT", "SUIT_ORDER", "ASC_VALUE"]
        },
        "requiresChooseCarriedFirst": { "type": "boolean" },

        "paramKey": { "type": "string", "minLength": 1 },
        "paramValue": { "type": "string", "minLength": 1 },

        "bargainOptions": {
          "type": "array",
          "minItems": 2,
          "items": { "$ref": "#/$defs/BargainOption" }
        }
      },
      "allOf": [
        {
          "if": { "properties": { "type": { "const": "SEQUENCE" } } },
          "then": { "required": ["effects"] }
        },
        {
          "if": { "properties": { "type": { "const": "CHOICE" } } },
          "then": { "required": ["promptKey", "options"] }
        },
        {
          "if": { "properties": { "type": { "const": "CONDITIONAL" } } },
          "then": { "required": ["if", "then", "else"] }
        },
        {
          "if": {
            "properties": {
              "type": {
                "enum": ["REROLL_REVEALED", "EXILE_REPLACE_REVEALED", "CLEANSE_REVEALED"]
              }
            }
          },
          "then": { "required": ["selector"] }
        },
        {
          "if": { "properties": { "type": { "const": "PEEK_TOP_N" } } },
          "then": { "required": ["n", "canReorder"] }
        },
        {
          "if": { "properties": { "type": { "const": "REORDER_TOP_N" } } },
          "then": { "required": ["n"] }
        },
        {
          "if": { "properties": { "type": { "const": "DISABLE_FATE_ACTION" } } },
          "then": { "required": ["fateAction", "scope"] }
        },
        {
          "if": { "properties": { "type": { "const": "SET_WEAPON_RESTRICTION_MODE" } } },
          "then": { "required": ["weaponRestrictionMode", "scope"] }
        },
        {
          "if": { "properties": { "type": { "const": "SET_ORDER_CONSTRAINT" } } },
          "then": { "required": ["orderConstraint", "requiresChooseCarriedFirst", "scope"] }
        },
        {
          "if": { "properties": { "type": { "const": "SET_FLOOR_PARAM" } } },
          "then": { "required": ["paramKey", "paramValue", "scope"] }
        },
        {
          "if": { "properties": { "type": { "const": "BARGAIN" } } },
          "then": { "required": ["promptKey", "options"] }
        }
      ]
    },

    "ChoiceOption": {
      "type": "object",
      "additionalProperties": false,
      "required": ["labelKey", "effect"],
      "properties": {
        "labelKey": { "$ref": "#/$defs/StringKey" },
        "effect": { "$ref": "#/$defs/EffectNode" }
      }
    },

    "BargainOption": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "payGold": { "type": "integer", "minimum": 0, "maximum": 9999 },
        "takeDamage": { "type": "integer", "minimum": 0, "maximum": 999 },
        "heal": { "type": "integer", "minimum": 0, "maximum": 999 },
        "gainGold": { "type": "integer", "minimum": 0, "maximum": 9999 }
      }
    },

    "Predicate": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kind"],
      "properties": {
        "kind": {
          "type": "string",
          "enum": ["ROOM_HAS_ENEMY", "ROOM_HAS_ANY_EFFECTIVE_REVERSED", "PLAYER_GOLD_AT_LEAST"]
        },
        "value": { "type": "integer", "minimum": 0, "maximum": 9999 }
      }
    }
  }
}
