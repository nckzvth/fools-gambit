# patch_20251227_0258_PHASEC_18400e6

Phase:

- PHASEC (Floors + boss)

Scope summary (what changed):

- Implemented floor lifecycle: floor start reshuffle, engaged-room counting, and transition into boss after 6 engaged rooms.
- Implemented boss fight: boss deck built from floor discard only, boss corruption (numbered minors resolve as reversed), boss room counting by floor range.
- Added unit tests for boss corruption + boss deck composition/transition.

Files changed:

- packages/game-core/src/engine.ts
- packages/game-core/src/rules.ts
- packages/game-core/src/engine.boss.test.ts
- devprogress/patch_20251227_0258_PHASEC_18400e6.md

Behavior changes (must map to spec sections):

- Floor start performs deterministic Minor deck reshuffle (spec §9).
- Boss deck is built only from the floor discard pile (spec §3.4, §10.1).
- Boss corruption forces numbered Minors to resolve as reversed unless cleansed (spec §3.1–§3.3, §10.1).
- Boss rooms required are 2/3/4 depending on floor range (spec §10.2).

New/updated tests:

- packages/game-core/src/engine.boss.test.ts

Replays added/updated:

- None (Phase C tests are unit-style; replay harness planned in later phases).

Content/schema changes:

- None.

Migration notes:

- saveVersion bump? no
- migration implemented? no

Known issues / follow-ups:

- Major claim/attunement/gifts/shadows are still stubbed; Phase D will wire majors via data-driven primitives (spec §18 Phase D).

Next phase entry criteria checklist:

- [x] Headless simulation can run a full floor loop and boss
- [x] Boss corruption + boss deck composition covered by tests
- [x] CI stays green (validate + typecheck + lint + test)
